<html><head></head><body><p><span style="color:#000000;">Здесь подробно рассказано о действиях, которые нужно выполнить для обновления системы на разных ОС</span></p><h3><span style="color:#000000;">Обновление сервера приложений, развернутого на Linux</span></h3><p>Скачиваем новую версию war-файла приложения и, если требуется, переименоваем  на IdeaPlatform_SAAS.war.</p><p><span lang="RU" style="color:#010101;">Заходим на сервер, на котором установлено приложение  через Putty и делаем бекап текущего war-файла:</span></p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;"><span style="color:#010101;">cp /opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war /usr/IPDumps/Web/IdeaPlatform_SAAS_<YYYYMMDD>.war</span></pre></div><p></p><p>Останавливаем Wildfly: </p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;"><span style="background-color:#f8f8f8;">systemctl stop wildfly </span></pre></div><p></p><p>Копируем новый war файл IdeaPlatform_SAAS.war в папку <WildfyHome>/standalone/deployments/:</p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">scp root@<application_host>:/opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war /opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war</pre></div><p></p><p>Выполняем обновление статических файлов. Из папки /opt/IPData/IdeaPlatform_SAAS/<span lang="RU" style="color:#010101;">trunk выполнить команду:</span></p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;"><span style="color:#010101;">svn update</span></pre></div><p><span lang="RU" style="color:#010101;"></span></p><p><span lang="RU" style="color:#010101;">Запускаем Wildfly:</span></p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">systemctl start wildfly</pre></div><p><span lang="RU" style="color:#010101;"></span></p><p><span lang="RU" style="color:#010101;">Проверяем, что система запустилась так:</span></p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">tail -f /var/log/wildfly/console.log</pre></div><p></p><p>или так:</p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">less /var/log/wildfly/console.log</pre></div><p></p><h4>Восстановление из бекапа приложения в случае возникновения проблем</h4><p>Если что-то идет не так, то восстановится можно из бекапа:</p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">cp /usr/IPDumps/Web/IdeaPlatform_SAAS_<YYYYMMDD>.war /opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war</pre></div><p><span lang="RU"></span></p><p><span lang="RU">при копировании нужно подтвердить переопределение файла </span><span style="color:#010101;">IdeaPlatform</span><span lang="RU" style="color:#010101;">_</span><span style="color:#010101;">SAAS</span><span lang="RU" style="color:#010101;">.</span><span style="color:#010101;">war</span><span lang="RU" style="color:#010101;"> (написать слово </span><span style="color:#010101;">yes</span><span lang="RU" style="color:#010101;">).</span></p><h4><span style="font-weight:700;"><span lang="RU" style="color:#010101;"></span></span><span style="font-weight:700;"><span lang="RU" style="color:#010101;">Как сделать дамп базы данных:</span></span></h4><p><span lang="RU" style="color:#010101;">Дамп базы данных можно сделать стандартными средствами Postrgres или путем выполнения </span><span style="color:#010101;">sh</span><span style="color:#010101;"> <span lang="RU">файла на сервере, где установлена СУБД</span></span><span lang="RU" style="color:#010101;">:</span></p><div style="background-color:#f8f8f8;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;padding:0.2em 0.6em;"><pre style="margin-bottom:0px;line-height:16.25px;">sh /usr/IPDump/autoDump.sh</pre><div></div></div><p></p><p>Cкрипт делает дамп системы и складывает его в папку /usr/IPDump/Dumps.</p><h3>Обновление системы, развернутой на Windows </h3><p>Зайти по <span lang="EN-US">RDP</span><span lang="EN-US"> </span>на нужный сервер.</p><p>Остановить службу "Wildfly"</p><p>Забекапить файл <span lang="EN-US"><WildFly HOME>\standalone\deployments\IdeaPlatform_SAAS.war</span></p><p>Удалить содержимое папки <span lang="EN-US"><WildFly HOME>\standalone\deployments</span></p><p>Разархивировать дистрибутив</p><p>Подменять файл <span lang="EN-US">system</span>.<span lang="EN-US">properties</span> на забекапленный файл не нужно, так как теперь файл <span style="font-weight:700;">system.properties</span> лежит в директории <em><span style="font-weight:700;">C:\WebServers\WildFly\wildfly-8.2.1.Final\standalone\configuration</span></em></p><p>Запустить службу "Wildfly"</p><p></p></body></html>