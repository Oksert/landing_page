<html><head></head><body><strong><span style="font-size:large;">Введение</span></strong><br>В приложении используются функциональные (e2e) тесты для тестирования всего приложения (клиентской и серверной части),  модульные (для тестирования отдельных классой и функций клиентской части) и нагрузочные тесты для тестирования скорости работы серверной части в условиях большого числа пользователей.<br><br><span style="font-size:large;"><strong>Функциональные тесты</strong></span><br>Функциональные тесты составляют основную часть тестов в приложении. Они написаны с использованием фреймоворка Protractor (http://www.protractortest.org), который представляет собой обертку над Selenium web driver, позволяющую писать тесты на JS и имеющую дополнительные функции для работы с Angular<br><br><span style="font-size:xx-large;">Описание и запуск функциональных тестов (для консультантов)</span><br><br><em><strong>1) Установка </strong></em><br>Ставим NodeJS и NPM, на windows - https://nodejs.org/en/<br>Ставим jdk и прописываем в переменную среды Path ссылку на папку bin в директорию, где установлена jdk. <br>Ставим через командную строку глобально protractor - https://angular.github.io/protractor/#/<br>npm install -g protractor<br>webdriver-manager update<br>webdriver-manager start<br>Скачиваем из SVN (ссылка на репозиторий https://subversion.assembla.com/svn/svn-ip) папку  ip-saas\test\<br>В коммандной строке переходим в папку ip-saas\test\e2e (можно скопировать из Git только её) и выполняем <br>npm install<br>Теперь запуск тестов можно выполнять как <span style="white-space:pre;">	</span><br>protractor allTestsConf.js<br><br><em><strong>2) Описание E2E тестов</strong></em><br>Настройки хранятся в файле globalConf.js<br>Наиболее важные -  <br>var host = '193.124.178.223'; // '193.124.178.223'  'runidea.online'   '127.0.0.1' - адрес системы, к которой мы подключаемся<br>var hostDB = '193.124.178.224'; //'193.124.178.224' null; - адрес субд (для списка пользователей и чтения почты)<br>var port = 8081 - порт системы к которой мы подключаемся<br>Порт СУБД считается равным 5432<br>config.directConnect - если установлено true - используется подключение к локальному браузеру, иначе к тому что прописано в config.seleniumAddress<br>Список тестов хранится в файле allTestsConf.js<br><br>ВАЖНО: Пока не реализовано создание WS для новых display все сценарии кроме 2 и 3 остановлены, а  сценарии 2 из запускаются из под пользователей указаyных в login.txt<br><br><em>Сценарий 1: Регистрация и приглашение пользователей</em><br>Файлы:<br>specs/registration/registration-spec.js<br>specs/registration/invitation-spec.js<br> * == Регистрация<br> * => не пришла почта<br> * => не было перенаправление на форму полной регистрации<br> * => не смогли войти в новый workspace<br> * => не получили приветсвия (можно продолжать при ошибке)<br> * => ошибка личного кабинета при сохранении  (можно продолжать при ошибке)<br> * <br> * == Приглашение<br> * => Не добавилась строка в список пользователей<br> * => Не пришло письмо приглашенному пользователю<br> * => не было перенаправление на форму полной регистрации<br> * => не смогли войти в workspace<br> * => ошибка личного кабинета при сохранении (можно продолжать при ошибке)<br> * <br> * => => => => => => <br><br><em>Сценарий 2: Работа руководителя команды</em><br>Файлы:<br>specs/managerScenario/project-with-tasks-spec.js<br>Заходим в систему под пользователем (владельцем WS - один из созданных в Сценарий #1 (один менеджер и один подчиненый))<br>Идем в пункт меню создать -> Проект<br>В открывшемся окне заполняем поля "Краткое описание" и "Описание"<br>Название: [Время] - Проект <br>Описание: [Время] - Описание проекта<br>Руководитель проекта: Любого пользователя<br>Переходим на вкладку "Задачи" и жмем на кнопку "Добавить запись"<br>В открывшемся окне заполняем поля "Краткое описание" и "Описание"<br>Краткое описание: [Время] - Задача  ##<user_email><br>Описание: [Время] - Описание задачи Задача ##<user_email><br>Где <user_email> -текущий пользователь. Нажимаем на кнопку "Создать", далее "Назад"<br>Повторяем пункты 4-5 для использую для <user_email> email подчиненного.<br>Переходим к пункту меню Найти -> Задачи, указываем на форме поиска статус Новый и нажимаем на кнопку "Поиск" <br>Выбираем любую из найденных задач, открываем и жмем на кнопку "Запланировать", в открывшемся окне указываем:<br>Исполнитель: заранее выбранный пользователь.<br>Плановое начало: текущий день и 12 часов <br>Плановое окончание: текущий день и 18 часов <br>Жмем на кнопку "ОК"<br>Жмем на кнопку "Комментировать", вводим комментарий и жмем кнопку "Отправить"  (можно продолжать при ошибке)<br>Повторяем пункты 7-9 пока есть задачи в статусе "Новая".<br>Переходим к пункту меню Отчеты - Календарь команды.<br>Передвигаем сроки и меняем длительность любой задачи.  (можно продолжать при ошибке)<br>Проваливаемся в одну из задач и меняем плановое начало и окончание на форме задач, жмем на кнопку "Сохранить"  (можно продолжать при ошибке)<br>Создаем одну задачу нажав правой кнопкой по календарю, выбираем пункт добавить задачу, заполняем поля и жмем "Создать"  (можно продолжать при ошибке)<br>Переходим на пункт меню "Отчеты-Дашборд руководителя", кликаем по столбцу "Задача не начата в срок" и пишем в ней произвольный комментарий  (можно продолжать при ошибке)<br><br>Выходим из системы<br><br><em>Сценарий 3: Работа члена команды (можно продолжать при ошибке)</em><br>Файлы:<br>specs/userScenario/tasks-for-user-spec.js<br><br>Войти в систему под пользователем - членом команды (не владельцем WS)<br>Дожидаемся загрузки меню 'Мои задачи'<br>Выбираем одну из задач в статусе "Запланирована", открываем задачу<br>Нажимаем на кнопку "В работу"<br>Жмем на кнопку "Комментировать", вводим комментарий и жмем кнопку "Отправить" <br>Жмем кнопку "На тестирование", вводим комментарий и жмем "ОК"<br>Открываем пункт меню Отчеты->Дашборд команды<br>Кликаем по отчету "Беклог задач", в открывшемся списки выбираем любую задачу и пишем к ней комментарий<br>Выходим из системы<br><br><em>Сценарий 4: Работа с entity</em><br>Файлы:<br>specs/newEntity/list-view-spec.js<br>specs/newEntity/new-entity-spec.js<br>specs/newEntity/save-new-entity-data-spec.js<br>specs/newEntity/form-editor-list-spec.js<br>specs/newEntity/form-editor-details-spec.js<br>specs/removeWorkspace/removeWorkspace-spec.js'<br><br>1) Заходим под руководителем WS в entity/entitytype и проверяем наличие стандартных записей data и reference<br>2) Пробуем создать новую entity<br>3) Добавляем всевозможные поля с разнным FieldFormat<br>4) Проверяем, что результирующее число полей правильное<br>5) Проверяем, что создались формы для списка и одной записи<br>6) Проверяем, что можем скрыть одну колонку и показать другую в редакторе списка<br>7) Проверяем, что создается новый таб в редакторе формы одной записи<br>8) Проверяем, что в него переносится запись в этот таб<br><br><em>Сценарий 5. Очистка созданного тестового WS.</em><br><br><span style="font-size:xx-large;">Описание функциональных тестов (для фронтенд разработчика)</span><br><br>Центральный файл вызываемый protractor - ip-saas\test\e2e\allTestsConf.js, в нем содержится список тестовых файлов, также он импортирует настройки ip-saas\test\e2e\globalConf.js<br><br>Рассмотрим настройки globalConf.js подробнее<br><br>defaultTimeoutInterval - стандартный таймаут на тест<br>allScriptsTimeout - таймаут на все тесты<br>getPageTimeout - таймаут на загрузку страницы<br>params.jenkins - настройки прокидываемый через командную строку jenkins`ом<br>onPrepare - настройка перед запуском<br>protractor.expliciteWaitTime - время принудительного ожидания<br>protractor.helpers - список библиотечных функций для выполения стандартных действий с формами, гридами и т.д.<br>jasmine.getEnv().addReporter - добавление отчетов для показа в jenkins<br>global.describe и global.it - переобределение стандартных функций для задания правил для возможности досрочного завершения теста<br><br>Описание проиходящего в сценариях уже есть в "Описание и запуск функциональных тестов (для консультантов)" рассмотрим как проиходит работа с формами, гридами, как происходит регистрация и работа с базой.<br><br>Базовый функционал тестов описан в ip-saas\test\e2e\helpers<br>    common-helpers.js<br>        scrollToSelector - прокрутка браузерного окна к указанному через селектор элементу, используется, когда protractor падает из-за невозможности нажать на элемент за пределами экрана<br>        waitForUrlToChange - ожидание смены url<br>        getTodayStr, getTodayClientDate, getTomorrowClientDate, toClientDate - получение и форматирование дат<br>    form-helpers.js - получение значений с формы и установка новых значений, нажатия на кнопку<br>        - getFieldSelector - получение значения селектора для отдельного поля<br>        - getField и setField - внутренние методы для получения/установки отдельного значения на форме, на текущей вкладке<br>        - openNextSection - внутренние метод для перехода на новую вкладку<br>        - processForm - внутрений метод для обхода вкладок, пока остались необработанные поля из списка и выполеннии заданной функции для каждого из переданных полей<br>        - setForm - установка значений формы, реализована через processForm и setField<br>        - getForm - получение значений формы, реализовано через processForm и getField<br>    designer-helpers.js - работа с дизайнером форм - устарело с введением новых форм<br>    file-helpers.js - синхронная работа с файлами, используется при чтении/сохранении паролей<br>    grid-helpers.js - работа с гридами <br>        - main, modal, subgrid(<fieldName>) - префиксы для обращения к гриду, когда он на форме поиска, связанным отчетом в модальном окне, и на форме одной записи соответственно<br>        остальны методы реализованы внутри functionsList, для доступа через префиксы<br>        - rowsList - получить список текущих строк<br>        - addRow - добавить запись<br>        - setSearch - установить праметры поиска<br>        - getTotalRows - получить общее число записей<br>        - upsert - открыть строку и если не нашлась, то вставить новую<br>        - openRow - открыть строку с заданным значением поля<br>        - scrollToRow - находит строку и делает ее доступной для скролинга, меняя страницу и область прокрутки,            <br>    login-helpers.js - методы для входа в систему и получение/сохранении данных текущего пользователя<br>    menu-helpers.js - переход к определенному пункту меню<br>    postgres-helpers.js - выполнить SQL-запрос<br>    scheduler-helpers.js - работа с календарем<br>        - main, subscheduler(<fieldName>) - префиксы для обращения к планировщику, когда он на форме поиска и на форме одной записи соответственно<br>        остальны методы реализованы внутри functionsList, для доступа через префиксы<br>        - tasksList - получить список текущих событий<br>        - getTask - получить событие по номеру dataUid<br>        - moveTask - сменить даты события с номером dataUid<br>    wait-helpers.js - стандартные функция ожидания<br><br><span style="font-size:xx-large;">Описание и запуск модульных тестов</span><br>Запуск происходит при помощи вызова <br>npm run test<br>который в свою очередь вызывает<br>karma start karma.conf.js --single-run<br>npm run test:watch делает тот же вызов, но без --single-run<br><br>Модульные тесты начали внедряться совсем недавно и на данный момент существуют только для модулей ip-saas\WebContent\src\convert и ip-saas\WebContent\src\connection<br>Тесты помещаются в папку __tests__ внутрь папки соответствующего модуля, а название теста выглядит как <название тестируемого файла>_spec.js<br>Пример: тесты для файла ip-saas\WebContent\src\convert\convert-utils.js лежат в ip-saas\WebContent\src\convert\__tests__\convert-utils_spec.js<br></body></html>