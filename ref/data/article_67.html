<html><head></head><body><h1 style="margin-bottom:7.5pt;"><span style="font-family:Helvetica, sans-serif;"></span>Настройка выгрузки в Word формы одной записи</h1><p style="margin-bottom:7.5pt;"><span style="font-family:Helvetica, sans-serif;">Для того, чтобы сформировать печатную форму в формате docx (формат Word ) нужно выполнить следующие действия:</span></p><ol><li><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Создаить шаблон выгрузки в формате .</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">docx</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> и вставить его на сервер.</span></li><li><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Создать правило по генерации выгрузки.</span></li><li><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Привязать это правило к кнопке, по нажатию на которую будет осуществляться выгрузка.</span></li></ol><p><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Ниже подробно описан каждый из пунктов.</span></p><p><span style="font-family:Helvetica, sans-serif;font-size:large;"><strong>Создание шаблона.</strong></span></p><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"></span>Для создания шаблона печатной формы нужно:</p><p style="margin-bottom:7.5pt;">1. Cформировать шаблано печатной формы нашего объекта по умолчанию.<br>Для этого необходимо выполнить следующий код:</p><blockquote style="margin-bottom:7.5pt;"><p><span style="font-family:'Courier New', Courier, monospace;">import ru.ip.server.office.WordExportEngine;</span></p><p><span style="font-family:'Courier New', Courier, monospace;">*****</span></p><span style="font-family:'Courier New', Courier, monospace;">WordExportEngine we = new WordExportEngine();</span><br><span style="font-family:'Courier New', Courier, monospace;">we.createTemplate("SM_TASK");</span><br><span style="font-family:'Courier New', Courier, monospace;">we.writeToFile("C:/TEMP/SM_TASK.docx");</span></blockquote><p style="margin-bottom:7.5pt;">Файл будет записан в файле <span style="font-size:17.5px;">C:/TEMP/SM_TASK.docx</span></p><p style="margin-bottom:7.5pt;"></p><p style="margin-bottom:7.5pt;">2. Заберите сфомированный файл с сервера и отредактируйте  его содержание и форматирование в Word:</p><ul><li><span style="font-family:Helvetica, sans-serif;">Для отображения в печатной форме атрибутов текущей формы</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> используйте их внутреннее имя внутри квадратных скобок. Например:</span></li></ul><p style="margin-bottom:7.5pt;margin-left:30px;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">[CLIENT_TITLE] – вернет хранящееся в БД значение поля «CLIENT_TITLE» из текущей формы.</span></p><ul><li><span style="font-family:Helvetica, sans-serif;font-size:10.5pt;">Для отображения расчетных значений и связанных данных можно использовать серверные методы и классы системы (подробнее <a href="./article_46.html">см. раздел «Серверные методы и классы API системы»</a>), </span><span style="font-family:Helvetica, sans-serif;font-size:10.5pt;">Для использования серверных методов запишите их внутри квадратных скобок. <br>Например: <br></span><span style="font-size:10.5pt;font-family:'Courier New', Courier, monospace;">[QueryUtils.getRecordById("R_ORGUNIT",record.getAsInteger("ORGUNIT")).getAsString("DISPLAYNAME")]</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> – в текущей записи есть поле «</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">ORGUNIT</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">», которое является ссылкой на запись в таблицу «R_ORGUNIT», в результате данный код вернет значение поля «DISPLAYNAME» для записи в таблице «</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">R</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">_ORGUNIT», ссылка на которую содержится в текущей записи в поле «ORGUNIT».</span></li></ul><ul><li>Для использования<span style="font-family:Helvetica, sans-serif;">  методов пользовательских классов (подробнее <a href="./article_48.html">см. раздел «Пользовательский API системы (Class Library)»</a>)</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">запишите их внутри квадратных скобок. Например:<br></span><span style="font-size:10.5pt;font-family:'Courier New', Courier, monospace;">[Lib.TemplateUtils.getFirstRSPDocUserTitle(record.getAsInteger("ORGUNIT"))] </span><span style="font-family:Helvetica, sans-serif;font-size:10.5pt;">– в пользовательской библиотеке «TemplateUtils» содержится метод «getFirstRSPDocUserTitle», которому на вход подается значение поля «ORGUNIT» из текущей записи.</span></li></ul><p style="margin-bottom:7.5pt;">3. Отключите в Word проверку орфографии и  <span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">сохранить полученный файл шаблона в формате .</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">xml.</span></p><p style="margin-bottom:7.5pt;"><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"></span>4. П<span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">роверьте целостность кода на предмет отсутствия непечатаемых символов внутри вашего кода, для этого:</span></p><ul><li><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Через любой текстовый редактор, например «Блокнот» или «</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Notepad</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">++», откройте файл и удалите все непечатаемые символы из строк, содержащих</span></li></ul><p><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">5. Cохраните его в формате .</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">docx</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> и загрузите на сервер в директорию </span><span style="font-size:10.5pt;font-family:'Courier New', Courier, monospace;background-color:#ffff33;">«C:\IPData\Templates».</span><br></p><p style="margin-bottom:7.5pt;"><span style="font-family:Helvetica, sans-serif;font-size:large;"><strong>Создание правила по генерации выгрузки:</strong></span></p><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Для того, чтобы добавить такое правило необходимо:</span></p><ol><li>В меню навигации проследовать: «Система управления – Администрирование – Правила - Правила».</li><li>Нажать кнопку «Добавить запись».</li><li>В открывшейся форме указать следующие обязательные поля:</li></ol><ul type="disc"><li><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">Имя (отображаемое имя правила).</span></li><li><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">Условие срабатывания (выражение      на языке Java, преобразующееся к булевой переменной - когда оно возвращает      значение «true», будет выполнен код из поля «Код».).</span></li><li><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">Код (реализация правила      производится на языке программирования Java, доступно использование данных      текущей записи record класса EntityDTO, API представлен в разделе      Серверные методы и классы API системы). Для</span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;"> </span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">выгрузки</span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;"> </span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">файла</span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;"> </span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">используйте</span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;"> </span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;">метод</span><span style="font-size:10.5pt;font-family:'Helvetica',sans-serif;"> </span></li></ul><blockquote style="margin-left:36pt;"><span lang="EN-US" style="font-size:10.5pt;font-family:'Courier New', Courier, monospace;">ExportUtils.exportRecordToWordAttachment(EntityDTO record, String attachFieldName, String attachFileName);</span></blockquote><p style="margin-left:36pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">где </span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">record</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> </span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">– текущая запись, </span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">attachFieldName</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> </span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">– поле типа «множественное вложение», в него будет выгружаться файл, </span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">attachFileName</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> </span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">– название выгружаемого файла.<br></span><br>Таким образом, после завершения работы кнопки печатная форма окажется в поле типа множественное вложение текущей формы (в поле a<span style="font-family:Helvetica, sans-serif;">ttachFieldName</span>)</p><p style="margin-left:36pt;"></p><p><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">      4. Нажать кнопку «Создать», затем «Готово».</span></p><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"></span></p><p style="margin-bottom:7.5pt;"><span style="font-family:Helvetica, sans-serif;font-size:large;"><strong>Привязка правила к кнопке, по нажатию на которую будет осуществляться выгрузка.</strong></span></p><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">Создание кнопок в объектах и привязка к ним правил описаны в разделе<a href="./article_22.html"> «Настройка кнопок в объектах»</a>.</span></p><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;"></span></p><p style="margin-bottom:7.5pt;"><strong><span style="font-size:large;">Отправка файла напрямую в браузер</span></strong></p><p style="margin-bottom:7.5pt;">Для загрузки файла напрямую в браузер необходимо в пункте 3 руководства по созданию правила по генерации выгрузки (см. выше в текущей статье) создать серверное правило с вызовом одного из следующего метода:</p><blockquote style="margin-bottom:7.5pt;margin-left:60px;"><span style="font-size:small;">ExportUtils.downloadWordRecord(EntityDTO record, String outFileName)</span></blockquote><p style="margin-bottom:7.5pt;"><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">где </span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">record</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> </span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">– текущая запись</span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">, </span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;">attachFileName</span><span lang="EN-US" style="font-size:10.5pt;font-family:Helvetica, sans-serif;"> </span><span style="font-size:10.5pt;font-family:Helvetica, sans-serif;">– название выгружаемого файла.</span></p></body></html>