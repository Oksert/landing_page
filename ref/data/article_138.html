<p><strong>Рассмотрим деплой клиента с точки зрения бэкенд разработчика/администратора.</strong><br /><br />Большая часть клиента собирается в два файла build.[hash].js и index.html, ссылающийся на build.[hash].js, которые кладуться сборкой в корень ip-saas\WebContent<br />Сборка выполняется командами (вызываются Jenkins каждый раз при изменении)<br />npm install - установка зависимостей приложения&nbsp;<br />npm run build:prod - сборка двух основных файлов<br />Чтобы сборка нормально работала, на осуществляющем сборку компьютере должны быть установлены NodeJS и NPM (обычно ставится сам вместе с NodeJS).<br />Кроме этого должен быть глобально установлен Webpack (на данный момент первой версии). Для этого нужно один раз после установки Ноды выполнить<br />npm i -g webpack@1.13.1<br />На текущем сервере Jenkins 94.142.142.227 всё это выполнено.<br />Кроме этого в файле index.html есть ссылки на файлы в папках ip-saas\WebContent\img, ip-saas\WebContent\vendor, ip-saas\WebContent\style, которые не требуют дополнительной обработки.<br /><br /><strong>Подведем итог.</strong> После окончания сборки клиента в папке ip-saas\WebContent находится релиз клиента со всеми зависимостями.<br />После сборки ant весь релиз находится внутри одного war-файла из которого клиентские файлы раздаются при помощи сервера WildFly.<br />Так сейчас работают все серверы РПМ. При этом нужно не забывать включать сжатие статических файлов средствами WildFly https://runidea.online/#/reference?entityId=348&amp;rowId=75.&nbsp;<br /><br /><strong>Возможен второй вариант (он используется на runidea.online).</strong><br />В качестве веб-сервера помимо WildFly может также использоваться Nginx. При этом на него возлагаются задачи раздачи статических файлов, сжатие файлов и реализация SSL. Поскольку Nginx не может раздавать статические файлы из war-архива деплой на такие инсталяции требуют дополнительных шагов.<br />Для апдейта сервера runidea.online используется файл <strong>/root/updateIPSystem.sh&nbsp;</strong><br />Рассмотрим его содержимое<br />set -v<br />systemctl stop wildfly<br />sshpass -p 'rpmSy$tem1231test' scp root@194.87.111.90:/opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war /opt/wildfly/standalone/deployments/IdeaPlatform_SAAS.war<br />cd /opt/IPData/ip-saas<br />git pull<br />npm i<br />npm run build:prod<br />systemctl start wildfly<br /><br />1) Остановка сервера WildFly<br />2) Копирование WAR-файла релиза с тестового сервера в папку /opt/wildfly/standalone/deployments<br />3) Переход в /opt/IPData/ip-saas где находится git-репозиторий с исходниками (ветка master)<br />4) Обновление исходников<br />5) Обновление библиотек и сборка клиента<br />6) Включение сервера WildFly<br /><br />При этом Nginx настроен раздавать актуальные статические файлы из папки /opt/IPData/ip-saas/WebContent, а все запросы к API передавать на порт 9090, на котором весит WildFly.<br /><br />Рассмотрим теперь настройки <strong>/etc/nginx/nginx.conf</strong> на сервере runidea.online, в исходниках он сохранен под именем ip-saas\nginx_runidea_online.conf<br /><br />Все до строки 23 ( access_log &nbsp;/var/log/nginx/access.log &nbsp;main; ) - стандартные настройки.<br />sendfile &nbsp; &nbsp; &nbsp; &nbsp;on; - необходимо для обноления статических файлов на лету.<br /><br />Строки 30 - 35 (с "gzip on" до "gzip_vary on" - настройки сжатия траффика gzip.<br />строки с 37 - 41 (с "ssl_session_cache" до "resolver 8.8.8.8")- настройки ssl-сессий<br /><br />Строки 53 - 57 (server, listen 80) - перенаправление всего трафика с 80-го порта на 443-ий для форсирования SSL, даже если пользователь зашел по http.<br /><br />Строки с 59 (server &nbsp;server_name runidea.online и до конца) - основные настройки. Помимо стандартных (server_name, listen 443)<br />ssl_certificate - сертификат SSL<br />ssl_certificate_key - ключ SSL<br />Далее идут три правила на обработку запросов (от частного к общему)<br />location = / {...} - отдельное правило на отдачу файла index.html при запросе по корневому адресу<br />location ~* \.(html|js|css|txt|jpg|png|gif|eot|svg|ttf|woff)$ {...} - правило на раздачу статики из /opt/IPData/ip-saas/WebContent/<br />location / {...} все запросы, не обработанные двумя предыдущими правилами отправляются на http://localhost:9090/, на котором весит WildFLy</p><p></p>