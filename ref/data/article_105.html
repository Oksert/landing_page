<html><head></head><body><h3 style="margin-left:30px;"><strong></strong>Работа объекта календарь, создание событий календаря из объектов системы</h3><h4 style="margin-left:30px;"><strong>Для создания нового календаря выполните следующие действия:</strong></h4><p style="margin-left:30px;">1. Перейдите к пункту «Система управления» панели навигации, расположенной в левой части экрана. Выберите пункт «<span>Администрирование – Календари - Настройка календарей</span>».</p><p style="margin-left:30px;">2. На открывшейся странице нажмите кнопку «Добавить запись».</p><p style="margin-left:30px;">3. В открывшейся форме укажите следующие поля:</p><ul style="margin-left:30px;"><li>Имя (укажите название календаря).</li><li>Разрешенные типы событий (выберите не менее одного типа событий, которые будут доступны для использования в календаре).</li></ul><p style="margin-left:30px;">4. Нажмите кнопку «Создать».</p><p style="margin-left:30px;">5. Перейдите в секцию «Рабочий график».</p><p style="margin-left:30px;">6. Укажите каждому дню недели время начала и окончания работы, а так же его тип - рабочий (WORKING) или не рабочий(NON-WORKING), для этого двойным кликом откройте соответствующую строку и внесите необходимые изменения. После внесения правок нажмите кнопку «Готово».</p><h4 style="margin-left:30px;"><strong>Создание событий календаря из объектов системы:</strong></h4><p style="margin-left:30px;">1. Перейдите к пункту «Система управления» панели навигации, расположенной в левой части экрана. Выберите пункт «Администрирование –  Календари - Связь календарей и объектов».</p><p style="margin-left:30px;">2. На открывшейся странице нажмите кнопку «Добавить запись».</p><p style="margin-left:30px;">3. В открывшейся форме укажите следующие поля: </p><ul style="margin-right:2em;margin-bottom:0.75em;padding:0px;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:22px;margin-left:30px;"><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Таблица источник (имя объекта на основании которого нужно создать событие календаря).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Условие создания события (условие, при выполнении которого нужно создавать событие).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Поле с датой начала события (имя поля, из которого нужно скопировать дату начала события).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Поле с датой окончания события (имя поля, из которого нужно скопировать дату окончания события).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Поле с именем события (имя поля, из которого нужно скопировать имя события).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Calendar Id (имя календаря, к которому нужно привязать событие).</span></li><li style="margin:0px;padding:0px;word-wrap:break-word;"><span style="font-size:small;">Calendar Id Calculation (код вычисления внутреннего номера календаря).</span></li></ul><p style="margin-left:30px;"><span style="font-size:small;">Пример кода в поле Calendar Id Calculation:</span></p><blockquote style="margin-left:30px;"><code style="font-size:15.75px;">Object calendarId=1;</code></blockquote><ul style="margin-left:30px;"><li><span style="font-size:small;">Mapping Calculation (код, который выполняется непосредственно перед добавлением события в базу).</span></li></ul><p style="margin-left:30px;"><br><span style="font-size:small;">Пример кода в поле Mapping Calculation:</span></p><blockquote style="margin-left:30px;"><code style="font-size:15.75px;">event.set("DISPLAYNAME", record.getAsString("DISPLAYNAME") + " TEST"</code></blockquote><p style="margin-left:30px;">где </p><ul style="margin-right:2em;margin-bottom:0.75em;padding:0px;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:22px;margin-left:30px;"><li style="margin:0px;padding:0px;word-wrap:break-word;">record - экземпляр объекта EntityDTO на основании которого создается события календаря</li><li style="margin:0px;padding:0px;word-wrap:break-word;">event - событие календаря, которое будет добавлено/обновлено</li></ul><p style="margin-left:30px;">4. Нажмите кнопку «Создать».</p><p style="margin-left:30px;">5. Связь указанных календаря и объекта системы создана.</p><p style="margin-left:30px;"><strong></strong></p><p style="margin-left:30px;"><strong></strong></p><p style="margin-left:30px;"><strong>Дополнительный API для добавления события календаря при добавлении, обновлении и удалении записи:</strong></p><ul><li><span style="line-height:1.6em;">CalendarUtils.syncEntity<span style="font-size:12px;">WithCalen</span>dar(record); </span><span style="line-height:1.6em;">- </span><span style="color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;line-height:22px;">добавляет/обновляет событие календаря. В случае, если условие не выполняется - событие календаря автоматически удаляется.</span></li><li><span style="color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;line-height:22px;"></span><span style="line-height:1.6em;">CalendarUtils.removeEntityFromCalendar(record); - удаляет событие календаря.</span></li><li><span style="line-height:1.6em;"></span>Для того, чтобы из отчета типа "Расписание" передать наименование групп (также как это выглядит в отчете) в создаваемую из этого отчета объект, нужно использовать переменные: </li></ul><p style="margin-left:60px;"><span style="color:#000000;">ContextUtils.getEnvironmentVars().get("group_1") - для групп</span><br style="color:#000000;"><span style="color:#000000;">ContextUtils.getEnvironmentVars().get("group_2") - для подгрупп</span><br style="color:#000000;"><span style="color:#000000;">ContextUtils.getEnvironmentVars().get("group_3") - для под-подгрупп ит.д.</span></p><p style="margin-left:30px;">Вот пример кода, который можно написать в  EntityFieldMapping:</p><blockquote>if (ContextUtils.getEnvironmentVars().get("group_1")!=null){<br>    EntityDTO ou = QueryUtils.getRecord("R_ORGUNIT","DISPLAYNAME=\""+ContextUtils.getEnvironmentVars().get("group_1")+"\"");<br>    if (ou!=null){<br>        destination.set("ORGUNIT",ou.getKeyValue());<br>        if (ContextUtils.getEnvironmentVars().get("group_2")!=null){<br>            EntityDTO track = QueryUtils.getRecord("SM_REPAIRTRACK","ORGUNIT="+ou.getKeyValue()+" and DISPLAYNAME = \""+ContextUtils.getEnvironmentVars().get("group_2")+"\"");<br>            if (track!=null)<br>                destination.set("REPAIRTRACK", track.getKeyValue()); <br>        }<br>    }<br>}</blockquote><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><p style="margin-left:30px;"><span style="font-weight:700;">Доступ к объектам календаря (просмотр, создание, изменение, удаление событий календаря) реализуется двумя способами:</span></p><p style="margin-left:30px;"></p><p style="margin-left:30px;">1. Добавить поле со специальным форматом поля к объекту (подробнее см. <a href="./article_18.html" target="_blank">здесь - раздел "Стиль поля - report"</a>)<br></p><p style="margin-left:30px;">2. Создать отчет типа расписание (подробнее см. <a href="./article_37.html" target="_blank">здесь</a>)</p><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><p style="margin-left:30px;"></p><ol style="margin-left:30px;"></ol></body></html>