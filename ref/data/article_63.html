<html><head></head><body><p>Для работы с данными формы (т.е. в <a href="/ref/index.html?41">клиентских правилах</a>) доступны следующие объекты:</p><h3><span lang="EN-US"><strong></strong></span>Объект record</h3><p><span lang="EN-US"><strong>record</strong></span> - содержит методы для чтения и изменения значений полей, а также таких параметров полей, как видимость, обязательность и редактируемость. </p><p>Доступные методы:</p><ul><li><strong>get</strong>: function(fieldName)=>fieldValue - получить значение поля (регистр fieldName не важен). Для полей<span lang="EN-US"> select/autocomplete/attachment, </span>имеющих вид<span lang="EN-US"> {value, displayValue}, </span>возвращает<span lang="EN-US"> value;</span></li><li><span lang="EN-US"><strong>getDisplayValue</strong>: function(fieldName)=>fieldValue - </span>получить значение<span lang="EN-US"> displayValue </span>для полей<span lang="EN-US"> select/autocomplete/attachment (</span>регистр<span lang="EN-US"> fieldName </span>не важен<span lang="EN-US">). </span>Для других типов полей возвращает null;</li><li><strong>set</strong>: function(fieldName, fieldValue) - изменение значение поля (регистр fieldName не важен);</li><li><span lang="EN-US"><strong>fields</strong>: function() => [fieldName_1, fieldName_2, ..., fieldName_N] - </span>получить список полей<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>map</strong>: function(function(fieldValue, fieldName)) => [Object_1, Object_2, ... </span>Object_N] - получение массива из результатов выполнения переданной функции над каждым из полей объекта;</li><li><strong>each</strong>: function(function(fieldValue, fieldName)) - тоже, что и map, но не возвращает значения;</li><li><span lang="EN-US"><strong>setVisible</strong>: function(fieldName, fieldValue)  - </span>изменение видимости поля<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>getVisible</strong>: function(fieldName) => boolean - </span>получение видимости поля<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>setRequired</strong>: function(fieldName, fieldValue) - </span>изменение обязательности поля<span lang="EN-US">;</span></li><li><strong>getRequired</strong>: function(fieldName) => boolean - получение обязательности поля;</li><li><span lang="EN-US"><strong>setEditable</strong>: function(fieldName, fieldValue) - </span>изменение редактируемости поля<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>getEditable</strong>: function(fieldName) => boolean - </span>получение редактируемости поля<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>setTabVisible</strong>: function(tabDisplayName, fieldValue) - </span>изменение видимости таба<span lang="EN-US"> (</span>по видимому имени<span lang="EN-US">);</span></li><li><span lang="EN-US"><strong>getTabVisible</strong>: function(tabDisplayName) => boolean - </span>получение видимости таба<span lang="EN-US"> (</span>по видимому имени<span lang="EN-US">);</span></li><li><span lang="EN-US"><strong>setFormEditable</strong>: function(true/false) - </span>изменение редактируемости формы<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>setFieldFormat</strong>: function(fieldName, fieldValue) - </span>установка формата поля<span lang="EN-US">, fieldValue </span>может быть либо числом и воспринимается как<span lang="EN-US"> id, </span>либо строка и воспринимается как<span lang="EN-US"> shortName;</span></li><li><span lang="EN-US"><strong>getFieldFormatId</strong>: function(fieldName) => boolean - </span>получение<span lang="EN-US"> id </span>формата поля<span lang="EN-US">;</span></li><li><span lang="EN-US"><strong>getFieldFormat</strong>: function(fieldName) => boolean - </span>получение<span lang="EN-US"> id </span>формата поля<span lang="EN-US"> (</span>алиас к<span lang="EN-US"> getFieldFormatId);</span></li><li><span lang="EN-US"><strong>getFieldFormatShortName</strong>: function(fieldName) => boolean - </span>получение<span lang="EN-US"> shortName </span>формата поля<span lang="EN-US">;</span></li></ul><h3>Объекты oldRecord, prevRecord и initialRecord</h3><p><span lang="EN-US"><strong>prevRecord</strong></span> - предыдущая версия <span lang="EN-US">record</span>, обновляется после каждого выполнения правил. Реализует те же методы, что и <span lang="EN-US">record</span> (методы <span lang="EN-US">set</span> не имеют смысла).</p><p><span lang="EN-US"><strong>oldRecord</strong></span> (также initialRecord) версия <span lang="EN-US">record</span>, полученная от сервера. </p><p>Проверкой prevRecord==oldRecord можно проверять, что правило выполняется первый раз либо сразу после обновления от сервера.</p><h3>Объект <span style="font-weight:700;"><strong>QueryUtils</strong></span></h3><p><span lang="EN-US"><strong>QueryUtils</strong></span> - реализует методы доступа к базе данных.</p><ul><li><span lang="EN-US"><strong>getRecordList</strong>: function(tableName, whereQuery) =>  [Object_1, Object_2, ... </span>Object_N] - получения записей из таблицы tableName с условием whereQuery. </li></ul><p><span style="font-weight:700;">Важно: метод делает синхронный запрос на сервер. Необходимо проверять, что<strong> он выполняется только на нажатие кнопки.</strong></span></p><h3><span style="font-weight:700;"><strong>Объект </strong></span><span style="font-weight:700;">ContextUtils</span></h3><p><strong>ContextUtils </strong>- реализует доступ к параметрам текущего пользователя.</p><p>Методы объекта:</p><ul><li><span lang="EN-US"><strong>getCurrentUserId</strong></span>() - возвращает код текущего пользователя;</li><li><span lang="EN-US"><span style="font-weight:700;">getCurrentUser</span></span>() - озвращает экземпляр объекта <span lang="EN-US">User</span>, несущий в себе информацию о текущем пользователе, полученную при логине пользователя имеет следующие методы для доступа к данным</li></ul><ul style="margin-left:30px;"><li><strong>getUserId</strong>() - возвращает код пользователя.<br></li><li><strong>getLoginName</strong>() - возвращает login name пользователя.</li><li><strong>getFullName</strong>() - возвращает ФИО пользователя.</li><li><strong>getRoleId</strong>() - возвращает код роли пользователя.</li><li><strong>getPwtResetCount </strong>() - возвращает число сбросов пароля пользователем</li><li><strong>getStatus</strong>() - возвращает статус регистрации пользователя.</li><li><strong>getWorkspaceId</strong>) { - возвращает код рабочего пространства пользователя.</li><li><strong>isInAccessGroup</strong>(Integer accessGroupId) - возвращает true, если пользователь входит в группу доступа с кодом accessGroupId и false - в противном случае.</li><p><strong>Важно: метод делает синхронный запрос на сервер.</strong></p></ul><h3>Объект alert</h3><p><strong>alert</strong> реализует методы работы с сообщениями. Используется для вывода сообщений и pop-up окон в интерфейсе пользователя.</p><p>Методы объекта:</p><ul style="margin-bottom:0px;"><li><span style="font-weight:700;">add</span><span style="font-weight:700;">: </span>function(alert) - Добавить сообщение. У параметра alert могут быть заданы следующие поля:<ul><li>duration - продолжительность в секундах, по-умолчанию 5</li><li>type - тип, по-умолчанию 'danger', также есть 'success' и 'warning'. Сообщения 'success' | 'warning' являются информационными. Сообщение 'danger' - блокирующим выполнение кнопки</li><li>msg - текст</li></ul></li><li><span style="font-weight:700;">getFields </span>: function(headerMessage, fieldName_1, fieldName_2, fieldName_3, ...) - Запросить у пользователя значения полей в модальном окне;</li><li><span style="font-weight:700;">getFields </span>: function(headerMessage, fieldNameList) - Запросить у пользователя значения полей в модальном окне;</li></ul><h3>Объект context</h3><p><span lang="EN-US"><span style="font-weight:700;">context</span></span> - содержит информацию о точке вызова правил. </p><p><span lang="EN-US">Может иметь параметры:</span></p><ul><li><span style="font-weight:700;">button </span>- если правила вызываются по нажатии на кнопку, то содержит информацию о данных кнопки.</li></ul><p></p></body></html>