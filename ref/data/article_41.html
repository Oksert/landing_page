<html><head></head><body><p class="IPStTextCxSpFirst">Клиентские правила предназначены для изменения внешнего вида формы в зависимости от ее содержания, а также для действий с данными, которые уже введены на форму, но еще не записаны на сервер (например, при создании нового объекта). </p><p class="IPStTextCxSpFirst">То есть возможно задавать дополнительную логику обработки данных в форме. Данная логика реализуется через набор правил на языке <span lang="EN-US">JavaScript</span>, которые в дальнейшем вызываются при изменении формы либо при нажатии на кнопку. Для изменения свойств полей таблиц используется использовать <a href="/ref/index.html?63" style="background-color:#ffffff;">Клиентские методы API системы</a>.</p><h3>Создание клиентских правил</h3><p class="IPStTextCxSpMiddle">Создание клиентского правила полностью аналогично <a href="/ref/index.html?40">созданию серверного правила</a>, при этом нужно выставить атрибут <strong>Выполняется на клиенте</strong> и в поле <strong>Код</strong> использовать выражение на <span lang="EN-US">JavaScript</span>, а не <span lang="EN-US">Java</span>. </p><p class="IPStTextCxSpMiddle">Поля <strong>Условие срабатывания</strong> содержит выражение на языке <span lang="EN-US">JavaScript</span>, которое преобразуется к булевой переменной. Если значение <span lang="EN-US">true</span>, то будет выполнен код из поля <strong>Код</strong> (т.е. также аналогично серверным правилам). Кроме того, дополнительные условные операторы могут быть и в самом коде.</p><p class="IPStTextCxSpMiddle"><o:p>В условиях срабатывания и Коде есть возможность обращаться к текущей записи (с помощью переменной record) и использовать <a href="/ref/index.html?63">Клиентские методы API системы</a>, подробнее о них читайте в статье по ссылке.</o:p></p><h3>Создание связи клиентского правила к объекту (таблице), переходу workflow и кнопке</h3><p class="IPStTextCxSpMiddle">После создания правила, его необходимо прикрепить к соответствующему <span lang="EN-US">EntityType</span>, кнопке или переходу <span class="IPSystemObjects"><span lang="EN-US">Workflow</span></span> – эта процедура полностью идентична аналогичной для <a href="/ref/index.html?40">серверных правил</a>. </p><p class="IPStTextCxSpMiddle">Клиентские правила напрямую из кнопок не вызываются. Для того, чтобы вызвать клиентское правило из кнопки необходимо изменить код правила, в условии срабатывания добавить "context.button != null", а выполняемый код "обернуть" в следующий код: </p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span> (context.button.buttonName<span style="color:#333333;">==</span><span style="background-color:#fff0f0;">"внутреннее имя кнопки"</span>){ [Код клиентского правила] }
</pre></div><p class="IPStTextCxSpMiddle"></p><p class="IPStTextCxSpMiddle">Например для кнопки с внутренним именем "create_act" код видоизмененного правила будет следующим:</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span> (context.button.buttonName<span style="color:#333333;">==</span><span style="background-color:#fff0f0;">"create_act"</span>){ 
     record.setVisible(<span style="background-color:#fff0f0;">'CLIENT_ORG'</span>, <span style="color:#008800;font-weight:bold;">true</span>);
     record.setVisible(<span style="background-color:#fff0f0;">'CLIENT_TITLE'</span>, <span style="color:#008800;font-weight:bold;">true</span>);
     record.setVisible(<span style="background-color:#fff0f0;">'CLIENT_FULLNAME'</span>, <span style="color:#008800;font-weight:bold;">true</span>);
     alerts.getFields(<span style="background-color:#fff0f0;">'Укажите информацию о представителе предприятия-заказчика'</span>,
     [<span style="background-color:#fff0f0;">'CLIENT_ORG'</span>,<span style="background-color:#fff0f0;">'CLIENT_TITLE'</span>,<span style="background-color:#fff0f0;">'CLIENT_FULLNAME'</span>]);
}
</pre></div><h3><span lang="EN-US">Примеры клиентских правил</span></h3><p class="IPNumberedLevel1">Запретить выполнение кнопок из <span class="IPSystemObjects"><span lang="EN-US">WorkFlow</span></span> всем, у кого в имени содержится '<span lang="EN-US">nnn</span>':</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span>(record.get(<span style="background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="background-color:#fff0f0;">'nnn'</span>) <span style="color:#333333;">>=</span> <span style="color:#0000DD;font-weight:bold;">0</span> <span style="color:#888888;">// если отображаемое имя содержит 'nnn'</span>
   <span style="color:#333333;">&&</span> context.button <span style="color:#888888;">// если произошел переход по кнопке</span>
   <span style="color:#333333;">&&</span> context.button.transitionId){  <span style="color:#888888;">// и кнопка из Workflow</span>
       alerts.add({msg<span style="color:#333333;">:</span><span style="background-color:#fff0f0;">'Переход запрещен'</span>}); <span style="color:#888888;">// Заблокировать переход и уведомить пользователя.</span>
}
</pre></div><p></p><p>Всем котам установить день рождения равным 01/01/2014:</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span>(record.get(<span style="background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="background-color:#fff0f0;">'кот'</span>) <span style="color:#333333;">>=</span> <span style="color:#0000DD;font-weight:bold;">0</span>){ <span style="color:#888888;">// если отображаемое имя содержит 'кот'</span>
    record.set(<span style="background-color:#fff0f0;">'BIRTHDAY'</span>, (<span style="color:#008800;font-weight:bold;">new</span> <span style="color:#007020;">Date</span>(<span style="color:#0000DD;font-weight:bold;">2014</span>, <span style="color:#0000DD;font-weight:bold;">0</span>, <span style="color:#0000DD;font-weight:bold;">1</span>, <span style="color:#0000DD;font-weight:bold;">12</span>, <span style="color:#0000DD;font-weight:bold;">0</span>, <span style="color:#0000DD;font-weight:bold;">0</span>))); <span style="color:#888888;">//установить поле день рождения</span>
}
</pre></div><p class="IPNumberedLevel1"></p><p class="IPNumberedLevel1">Не показывать день рождения собак:</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span>(record.get(<span style="background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="background-color:#fff0f0;">'пес'</span>) <span style="color:#333333;">>=</span> <span style="color:#0000DD;font-weight:bold;">0</span> <span style="color:#888888;">// если отображаемое имя содержит 'пес'</span>
<span style="color:#333333;">||</span>record.get(<span style="background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="background-color:#fff0f0;">'собака'</span>) <span style="color:#333333;">>=</span> <span style="color:#0000DD;font-weight:bold;">0</span>)  { <span style="color:#888888;">// или 'собака'</span>
         record.setVisible(<span style="background-color:#fff0f0;">'BIRTHDAY'</span>, <span style="color:#008800;font-weight:bold;">false</span>); <span style="color:#888888;">//скрыть поле день рождения</span>
}<span style="color:#008800;font-weight:bold;">else</span>{
         record.setVisible(<span style="background-color:#fff0f0;">'BIRTHDAY'</span>, <span style="color:#008800;font-weight:bold;">true</span>); <span style="color:#888888;">//показать поле день рождения</span>
}
</pre></div><p class="IPNumberedLevel1"></p><p class="IPNumberedLevel1">Вывести список всех изменившихся записей:</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;">console.log(
   record.map(<span style="color:#008800;font-weight:bold;">function</span>(val, name){
      <span style="color:#008800;font-weight:bold;">return</span> {field<span style="color:#333333;">:</span> name, value<span style="color:#333333;">:</span> val, oldValue<span style="color:#333333;">:</span> initialRecord.get(name)};
   })
   .filter(<span style="color:#008800;font-weight:bold;">function</span>(el){
       <span style="color:#008800;font-weight:bold;">return</span> <span style="color:#333333;">!</span>_.isEqual(el.value, el.oldValue);
   })
)
</pre></div><p class="IPNumberedLevel1"></p><p class="IPNumberedLevel1">Использовать одно поле в качестве формата к другому: </p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">var</span> fieldShortName <span style="color:#333333;">=</span> record.get(<span style="background-color:#fff0f0;">'DISPLAYNAME'</span>)
<span style="color:#008800;font-weight:bold;">if</span>(fieldShortName) {
    record.setFieldFormat(<span style="background-color:#fff0f0;">'PARENT_ID'</span>, fieldShortName)
}
</pre></div><p></p><p>Запросить поля типа комментарий. Для таких полей нужна проверка проверяющая, что изменилось общее число комментариев, а не что поле комментария не пустое, так как само поле - это <span style="font-weight:700;">массив</span>:</p><div style="background:#ffffff;overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin:0;line-height:125%;"><span style="color:#008800;font-weight:bold;">if</span>(initialRecord.get(<span style="background-color:#fff0f0;">'COMMENTS'</span>).length <span style="color:#333333;">===</span>  record.get(<span style="background-color:#fff0f0;">'COMMENTS'</span>).length){
    alerts.getFields(<span style="background-color:#fff0f0;">'Укажите комментарий'</span>, <span style="background-color:#fff0f0;">'COMMENTS'</span>);
}
</pre></div></body></html>