<p class="IPStTextCxSpFirst">Клиентские правила предназначены для изменения внешнего вида формы в зависимости от ее содержания, а также для действий с данными, которые уже введены на форму, но еще не записаны на сервер (например, при создании нового объекта). То есть возможно задавать дополнительную логику обработки данных в форме. Данная логика реализуется через набор правил на языке <span lang="EN-US">JavaScript</span>, которые в дальнейшем вызываются при изменении формы либо при нажатии на кнопку.<o:p></o:p></p><p class="IPStTextCxSpMiddle">Создание клиентского правила полностью аналогично созданию серверного правила, при этом нужно выставить атрибут &laquo;Выполняется на клиенте&raquo; и в поле &laquo;Код&raquo; использовать выражение на <span lang="EN-US">JavaScript</span>, а не <span lang="EN-US">Java</span>. Поля &laquo;Условие срабатывания&raquo; содержит выражение на языке <span lang="EN-US">JavaScript</span>, преобразующееся к булевой переменной, когда оно <span lang="EN-US">true</span>, будет выполнен код из поля &laquo;Код&raquo; (т.е. также аналогично серверным правилам). Кроме того, дополнительные условные операторы могут быть и в самом коде.<o:p></o:p></p><p class="IPStTextCxSpMiddle">После создания правила, его необходимо прикрепить к соответствующему <span lang="EN-US">EntityType</span>, кнопке или переходу <span class="IPSystemObjects"><span lang="EN-US">Workflow</span></span> &ndash; эта процедура полностью идентична аналогичной для серверных правил. Клиентские правила напрямую из кнопок не вызываются. Для того, чтобы вызвать клиентское правило из кнопки необходимо изменить код правила, в условии срабатывания добавить "context.button != null", а выполняемый код "обернуть" в следующий код: "if (context.button.buttonName=="внутреннее имя кнопки"){ [КОД КЛИЕНТСКОГО ПРАВИЛА] }", например для кнопки с внутренним именем "create_act" код видоизмененного правила будет следующим:</p>if (context.button.buttonName=="create_act"){&nbsp;<br /><span class="Apple-tab-span" style="white-space:pre;"></span>record.setVisible('CLIENT_ORG', true);<br /><span class="Apple-tab-span" style="white-space:pre;"></span>record.setVisible('CLIENT_TITLE', true);<br /><span class="Apple-tab-span" style="white-space:pre;"></span>record.setVisible('CLIENT_FULLNAME', true);<br /><span class="Apple-tab-span" style="white-space:pre;"></span>alerts.getFields('Укажите информацию о представителе предприятия-заказчика',['CLIENT_ORG','CLIENT_TITLE','CLIENT_FULLNAME']);<br />}<p class="IPStTextCxSpMiddle"></p><p class="IPStTextCxSpLast"><span lang="EN-US">Примеры клиентских правил:<o:p></o:p></span></p><p class="IPNumberedLevel1"><!--[if !supportLists]-->1.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp; </span><!--[endif]-->Запретить выполнение кнопок из <span class="IPSystemObjects"><span lang="EN-US">WorkFlow</span></span> всем, у кого в имени содержится '<span lang="EN-US">nnn</span>':<o:p></o:p></p><p class="IPCodeExampleCxSpFirst"><span lang="EN-US"></span></p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;"><span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">if</span>(record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'nnn'</span>) <span style="margin:0px;padding:0px;color:#333333;">&gt;=</span> <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span> <span style="margin:0px;padding:0px;color:#888888;">// если отображаемое имя содержит 'nnn'</span>
   <span style="margin:0px;padding:0px;color:#333333;">&amp;&amp;</span> context.button <span style="margin:0px;padding:0px;color:#888888;">// если произошел переход по кнопке</span>
   <span style="margin:0px;padding:0px;color:#333333;">&amp;&amp;</span> context.button.transitionId){  <span style="margin:0px;padding:0px;color:#888888;">// и кнопка из Workflow</span>
       alerts.add({msg<span style="margin:0px;padding:0px;color:#333333;">:</span><span style="margin:0px;padding:0px;background-color:#fff0f0;">'Переход запрещен'</span>}); <span style="margin:0px;padding:0px;color:#888888;">// Заблокировать переход и уведомить пользователя.</span>
}
</pre><div></div></div><p class="IPNumberedLevel1"><!--[if !supportLists]--></p><p>2. Всем котам установить день рождения равным 01/01/2014:</p><div></div><p class="IPNumberedLevel1"></p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;"><span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">if</span>(record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'кот'</span>) <span style="margin:0px;padding:0px;color:#333333;">&gt;=</span> <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span>){ <span style="margin:0px;padding:0px;color:#888888;">// если отображаемое имя содержит 'кот'</span>
    record.set(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'BIRTHDAY'</span>, (<span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">new</span> <span style="margin:0px;padding:0px;color:#007020;">Date</span>(<span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">2014</span>, <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span>, <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">1</span>, <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">12</span>, <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span>, <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span>))); <span style="margin:0px;padding:0px;color:#888888;">//установить поле день рождения</span>
}</pre><div></div></div><p class="IPCodeExampleCxSpLast"><span lang="EN-US"><o:p></o:p></span></p><p class="IPNumberedLevel1"><!--[if !supportLists]-->3.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp; </span><!--[endif]-->Не показывать день рождения собак:<o:p></o:p></p><p class="IPCodeExampleCxSpFirst"><span lang="EN-US"></span></p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;"><span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">if</span>(record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'пес'</span>) <span style="margin:0px;padding:0px;color:#333333;">&gt;=</span> <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span> <span style="margin:0px;padding:0px;color:#888888;">// если отображаемое имя содержит 'пес'</span>
  <span style="margin:0px;padding:0px;color:#333333;">||</span>record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'DISPLAYNAME'</span>).toLowerCase().search(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'собака'</span>) <span style="margin:0px;padding:0px;color:#333333;">&gt;=</span> <span style="margin:0px;padding:0px;color:#0000dd;font-weight:bold;">0</span>)  { <span style="margin:0px;padding:0px;color:#888888;">// или 'собака'</span>
    record.setVisible(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'BIRTHDAY'</span>, <span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">false</span>); <span style="margin:0px;padding:0px;color:#888888;">//скрыть поле день рождения</span>
}<span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">else</span>{
    record.setVisible(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'BIRTHDAY'</span>, <span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">true</span>); <span style="margin:0px;padding:0px;color:#888888;">//показать поле день рождения</span>
}
</pre><div></div></div><p class="IPCodeExampleCxSpLast"><span lang="EN-US"><o:p></o:p></span></p><p class="IPNumberedLevel1"><!--[if !supportLists]-->4.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp; </span><!--[endif]-->Вывести список всех изменившихся записей:<o:p></o:p></p><p class="IPCodeExampleCxSpFirst"><span lang="EN-US"></span></p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;">console.log(
   record.map(<span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">function</span>(val, name){
      <span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">return</span> {field<span style="margin:0px;padding:0px;color:#333333;">:</span> name, value<span style="margin:0px;padding:0px;color:#333333;">:</span> val, oldValue<span style="margin:0px;padding:0px;color:#333333;">:</span> initialRecord.get(name)};
   })
   .filter(<span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">function</span>(el){
       <span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">return</span> <span style="margin:0px;padding:0px;color:#333333;">!</span>_.isEqual(el.value, el.oldValue);
   })
)
</pre><div></div></div><p class="IPCodeExampleCxSpLast"><span lang="EN-US"><o:p></o:p></span></p><p class="IPNumberedLevel1"><!--[if !supportLists]-->5.<span style="font-size:7pt;line-height:normal;font-family:'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp; </span><!--[endif]-->Использовать одно поле в качестве формата к другому: <o:p></o:p></p><p class="IPCodeExampleCxSpFirst"><span lang="EN-US"></span></p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;"><span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">var</span> fieldShortName <span style="margin:0px;padding:0px;color:#333333;">=</span> record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'DISPLAYNAME'</span>)
<span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">if</span>(fieldShortName) {
    record.setFieldFormat(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'PARENT_ID'</span>, fieldShortName)
}
</pre><div></div></div><p class="IPCodeExampleCxSpLast"><br /></p><p>6. Запросить поля типа комментарий. Для таких полей нужна проверка проверяющая, что изменилось общее число комментариев, а не что поле комментария не пустое, так как само поле - это&nbsp;<strong>массив</strong>:</p><div style="margin:0px;padding:0.2em 0.6em;color:#213140;font-family:'Helvetica Neue', Helvetica, arial, 'Liberation Sans', FreeSans, sans-serif;font-size:12px;line-height:16.8px;overflow:auto;width:auto;border-style:solid;border-color:gray;border-width:0.1em 0.1em 0.1em 0.8em;background-image:initial;background-attachment:initial;background-size:initial;background-origin:initial;background-clip:initial;background-position:initial;background-repeat:initial;"><pre style="margin-bottom:0px;padding:10px;font-family:Monaco, 'Bitstream Vera Sans Mono', monospace, Courier;color:#455464;border-radius:3px;line-height:12.9px;font-size:10.32px;background-color:#e7fafd;"><span style="margin:0px;padding:0px;color:#008800;font-weight:bold;">if</span>(initialRecord.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'COMMENTS'</span>).length <span style="margin:0px;padding:0px;color:#333333;">===</span>  record.get(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'COMMENTS'</span>).length){
    alerts.getFields(<span style="margin:0px;padding:0px;background-color:#fff0f0;">'Укажите комментарий'</span>, <span style="margin:0px;padding:0px;background-color:#fff0f0;">'COMMENTS'</span>);
}</pre></div><p class="IPCodeExampleCxSpLast"></p><p class="IPNumberedLevel1CxSpLast"><o:p></o:p></p>